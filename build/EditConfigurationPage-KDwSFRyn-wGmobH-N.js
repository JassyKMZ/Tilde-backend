import{h as b,u as I,k as A,m as N,co as k,cw as w,f7 as D,r as v,eR as R,j as s,P as u}from"./strapi-DAjSWN8J.js";import{C as O,T as U}from"./Form-BrzQyDxU-C9f7VDEY.js";import{u as G}from"./hooks-DMvik5y_-D7SueOrx.js";import{s as H}from"./objects-wl73iEma-Cb1-5n3_.js";import"./useDragAndDrop-HYwNDExe-4SHDNxx-.js";import"./ComponentIcon-BZcTc4rj-BZaELvRC.js";import"./FieldTypeIcon-BY6MrVF4-DyiWTrm7.js";import"./getEmptyImage-CjqolaH3.js";const Q=()=>{const{trackUsage:n}=b(),{formatMessage:o}=I(),{toggleNotification:a}=A(),{_unstableFormatAPIError:c}=N(),{isLoading:h,schema:y,model:F}=k(),{isLoading:L,error:S,list:E,edit:g}=w(),{fieldSizes:x,error:d,isLoading:_,isFetching:j}=D(void 0,{selectFromResult:e=>{const m=Object.entries(e.data?.fieldSizes??{}).reduce((r,[t,{default:i}])=>(r[t]=i,r),{});return{isFetching:e.isFetching,isLoading:e.isLoading,error:e.error,fieldSizes:m}}});v.useEffect(()=>{d&&a({type:"danger",message:c(d)})},[d,c,a]);const C=h||L||_||j,[M]=R(),P=async e=>{try{n("willSaveContentTypeLayout");const m=Object.entries(E.metadatas).reduce((t,[i,{mainField:l,...f}])=>{const z=g.metadatas[i],{__temp_key__:V,size:$,name:q,...T}=e.layout.flatMap(p=>p.children).find(p=>p.name===i)??{};return t[i]={edit:{...z,...T},list:f},t},{}),r=await M({layouts:{edit:e.layout.map(t=>t.children.reduce((i,{name:l,size:f})=>l!==U?[...i,{name:l,size:f}]:i,[])),list:E.layout.map(t=>t.name)},settings:H(e.settings,"displayName",void 0),metadatas:m,uid:F});"data"in r?(n("didEditEditSettings"),a({type:"success",message:o({id:"notification.success.saved",defaultMessage:"Saved"})})):a({type:"danger",message:c(r.error)})}catch{a({type:"danger",message:o({id:"notification.error",defaultMessage:"An error occurred"})})}};return C?s.jsx(u.Loading,{}):d||S||!y?s.jsx(u.Error,{}):s.jsxs(s.Fragment,{children:[s.jsx(u.Title,{children:`Configure ${g.settings.displayName} Edit View`}),s.jsx(O,{onSubmit:P,attributes:y.attributes,fieldSizes:x,layout:g})]})},te=()=>{const n=G(o=>o.admin_app.permissions.contentManager?.collectionTypesConfigurations);return s.jsx(u.Protect,{permissions:n,children:s.jsx(Q,{})})};export{Q as EditConfigurationPage,te as ProtectedEditConfigurationPage};
